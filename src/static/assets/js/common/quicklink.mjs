function e(e,n){return void 0===n&&(n="prefetch"),(e=document.createElement("link")).relList&&e.relList.supports&&e.relList.supports(n)}function n(e,n){return new Promise(function(t,r,o){(o=document.createElement("link")).rel=n,o.href=e,o.onload=t,o.onerror=r,document.head.appendChild(o)})}function t(e){return new Promise(function(n,t,r){(r=new XMLHttpRequest).open("GET",e,r.withCredentials=!0),r.onload=function(){200===r.status?n():t()},r.send()})}function r(e){return window.fetch?fetch(e,{credentials:"include"}):t(e)}var o=e(void 0,"prefetch")?function(e){return n(e,"prefetch")}:t,i=e(void 0,"prerender")?function(e){return n(e,"prerender")}:o,c=window.requestIdleCallback||function(e){var n=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-n))}})},1)},u=new Set,f=new Set;function a(e){if(e||(e={}),window.IntersectionObserver){var n=function(e){e=e||1;var n=[],t=0;function r(){t<e&&n.length>0&&(n.shift()(),t++)}return[function(e){n.push(e)>1||r()},function(){t--,r()}]}(e.throttle||1/0),t=n[0],r=n[1],o=e.limit||1/0,i=e.origins||[location.hostname],a=e.ignores||[],l=e.delay||0,d=e.relAttr||"prefetch",h=[],p=e.timeoutFn||c,m="function"==typeof e.hrefFn&&e.hrefFn,w=new IntersectionObserver(function(n){n.forEach(function(n){if(n.isIntersecting)h.push((n=n.target).href),function(e,n){n?setTimeout(e,n):e()}(function(){-1!==h.indexOf(n.href)&&(w.unobserve(n),("prefetch"===d&&u.size<o||"prerender"===d&&f.size<o)&&t(function(){s(m?m(n):n.href,d,e.priority).then(r).catch(function(n){r(),e.onError&&e.onError(n)})}))},l);else{var i=h.indexOf((n=n.target).href);i>-1&&h.splice(i)}})});return p(function(){(e.el||document).querySelectorAll("a").forEach(function(e){i.length&&!i.includes(e.hostname)||function e(n,t){return Array.isArray(t)?t.some(function(t){return e(n,t)}):(t.test||t).call(t,n.href,n)}(e,a)||w.observe(e)})},{timeout:e.timeout||2e3}),function(){"prefetch"===d?u.clear():"prerender"===d&&f.clear(),w.disconnect()}}}function s(e,n,t,c){if(c=navigator.connection){if(c.saveData)return Promise.reject(new Error("Cannot prefetch, Save-Data is enabled"));if(/2g/.test(c.effectiveType))return Promise.reject(new Error("Cannot prefetch, network conditions are poor"))}var a="prerender"===n?f:u,s="prerender"===n?i:o;return t&&(s=r),Promise.all([].concat(e).map(function(e){if(!a.has(e))return a.add(e),s(new URL(e,location.href).toString())}))}function l(e,n,t){return s(e,"prefetch",n,t)}function d(e,n,t){return s(e,"prerender",n,t)}export{a as listen,l as prefetch,d as prerender};
